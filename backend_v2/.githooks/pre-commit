#!/bin/bash

# Pre-commit hook for AlphaPulse architecture validation
# 
# This runs lightweight architecture checks before each commit
# to catch violations early in the development process.
#
# To install: 
#   git config core.hooksPath .githooks

set -e

echo "üîç Running architecture validation checks..."

# Run quick validation checks (subset for speed)
cd tests/architecture_validation

# Only run critical checks in pre-commit for speed
if cargo run --release -- --quick-check 2>/dev/null; then
    echo "‚úÖ Architecture validation passed"
else
    echo "‚ùå Architecture validation failed"
    echo ""
    echo "To see full details, run:"
    echo "  cd tests/architecture_validation && cargo run"
    echo ""
    echo "To bypass this check (not recommended):"
    echo "  git commit --no-verify"
    echo ""
    exit 1
fi

# Also run cargo fmt check
echo "üé® Checking code formatting..."
if ! cargo fmt -- --check; then
    echo "‚ùå Code is not formatted. Run 'cargo fmt' to fix."
    exit 1
fi

echo "‚ú® All pre-commit checks passed"
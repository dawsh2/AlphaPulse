<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Connection Test</title>
    <style>
        body { font-family: monospace; background: #1a1a1a; color: #00ff00; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border: 1px solid #333; }
        .connected { background: #001100; border-color: #00ff00; }
        .disconnected { background: #110000; border-color: #ff0000; }
        #messages { max-height: 400px; overflow-y: auto; border: 1px solid #333; padding: 10px; }
    </style>
</head>
<body>
    <h1>üöÄ AlphaPulse WebSocket Connection Test</h1>
    
    <div id="status" class="status disconnected">
        Status: Disconnected
    </div>
    
    <button onclick="connect()">Connect</button>
    <button onclick="disconnect()">Disconnect</button>
    <button onclick="subscribe()">Subscribe</button>
    
    <h3>Messages:</h3>
    <div id="messages"></div>
    
    <script>
        let ws = null;
        const statusEl = document.getElementById('status');
        const messagesEl = document.getElementById('messages');
        
        function updateStatus(message, connected) {
            statusEl.textContent = `Status: ${message}`;
            statusEl.className = `status ${connected ? 'connected' : 'disconnected'}`;
        }
        
        function addMessage(message) {
            const div = document.createElement('div');
            div.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            messagesEl.appendChild(div);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }
        
        function connect() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                addMessage('Already connected');
                return;
            }
            
            const url = 'ws://localhost:8765/stream';
            addMessage(`Connecting to ${url}...`);
            
            ws = new WebSocket(url);
            
            ws.onopen = () => {
                updateStatus('Connected', true);
                addMessage('‚úÖ WebSocket connected successfully!');
            };
            
            ws.onmessage = (event) => {
                addMessage(`üì® Received: ${event.data}`);
            };
            
            ws.onclose = () => {
                updateStatus('Disconnected', false);
                addMessage('‚ùå WebSocket disconnected');
            };
            
            ws.onerror = (error) => {
                updateStatus('Error', false);
                addMessage(`‚ùå WebSocket error: ${error}`);
            };
        }
        
        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
            }
        }
        
        function subscribe() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                const msg = {
                    msg_type: 'subscribe',
                    channels: ['trades', 'orderbook'],
                    symbols: ['BTC-USD', 'ETH-USD']
                };
                ws.send(JSON.stringify(msg));
                addMessage(`üì§ Sent subscription: ${JSON.stringify(msg)}`);
            } else {
                addMessage('‚ùå Not connected');
            }
        }
        
        // Auto-connect on load
        connect();
    </script>
</body>
</html>